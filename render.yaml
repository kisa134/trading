services:
  - type: web
    name: trading-api
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m api.main --port $PORT
    envVars:
      - fromGroup: trading-env

  - type: web
    name: trading-frontend
    env: static
    rootDir: trading_platform/frontend
    buildCommand: npm ci && npm run build
    staticPublishPath: dist

  - type: worker
    name: hot-storage
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m storage.hot --redis $REDIS_URL
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: ingestor-bybit
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m ingestors.bybit.main --redis $REDIS_URL --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: ingestor-binance
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m ingestors.binance.main --redis $REDIS_URL --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: ingestor-okx
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m ingestors.okx.main --redis $REDIS_URL --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: tape-aggregator
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.tape_aggregator --redis $REDIS_URL
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: iceberg-detector
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.iceberg_detector --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: wall-spoof-detector
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.wall_spoof_detector --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: heatmap-footprint
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.heatmap_footprint_aggregator --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: feature-candles
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.feature_engine_candles --redis $REDIS_URL
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: feature-volume
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.feature_engine_volume --redis $REDIS_URL
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: feature-orderbook
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.feature_engine_orderbook --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: trend-score
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.trend_score_engine --redis $REDIS_URL --exchange bybit --symbol BTCUSDT --window 50
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: exhaustion-engine
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.exhaustion_engine --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

  - type: worker
    name: rule-reversal
    env: python
    rootDir: trading_platform
    buildCommand: pip install -r requirements.txt
    startCommand: python -m analytics.rule_reversal_engine --redis $REDIS_URL --exchange bybit --symbol BTCUSDT
    envVars:
      - fromGroup: trading-env

envVarGroups:
  - name: trading-env
    envVars:
      - key: REDIS_URL
        sync: false
