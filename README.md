# Квадраты аномального объема

Визуализация потока сделок Bybit в реальном времени: квадраты по цене (Y) и времени (X), размер — объём, цвет — направление (зелёный = покупка, красный = продажа), яркость — аномальность объёма относительно скользящего среднего последних 100 сделок.

## Требования

- Python 3.10+
- Браузер с поддержкой WebSocket и Canvas

## Запуск

### 1. Backend (Python)

```bash
cd backend
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
python main.py
```

По умолчанию: символ `BTCUSDT`, порт `8765`. Опции:

```bash
python main.py --symbol ETHUSDT --port 8765
```

### 2. Frontend

Открой в браузере файл `frontend/index.html` (двойной клик или через локальный сервер):

```bash
cd frontend
python -m http.server 8080
```

Затем открой в браузере: http://localhost:8080

Либо открой `frontend/index.html` напрямую — страница подключается к `ws://localhost:8765`.

## Логика визуализации

| Параметр | Источник | Реализация |
|----------|----------|------------|
| Позиция Y | Цена сделки | Масштаб по min/max цены в окне |
| Позиция X | Порядок сделок | Скользящее окно (последние 200–500), новые справа |
| Размер квадрата | Объём | Пропорционален объёму (с ограничением) |
| Цвет | Направление | Зелёный = Buy, Красный = Sell |
| Яркость | Аномальность | `anomaly_score` → opacity 0.2–1.0 |

Backend считает `anomaly_score = volume / rolling_avg(100)` и ограничивает его для стабильной шкалы яркости на фронте.
